<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content="light dark" name=color-scheme><title>Hello World App for PineTime Using PineSim</title><link href=/img/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=/img/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=/img/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=https://fonts.googleapis.com rel=preconnect><link crossorigin href=https://fonts.gstatic.com rel=preconnect><link href="https://fonts.googleapis.com/css2?family=Signika&display=swap" rel=stylesheet><style>body{--primary-color:#698bcf;--primary-pale-color:#698bcf1c;--text-color:#3c4043;--text-pale-color:#9aa2b9;--bg-color:#fff;--highlight-mark-color:#5f75b045;--callout-note-color:#698bcf;--callout-important-color:#9971d9;--callout-warning-color:#c99054;--callout-alert-color:#d35757;--callout-question-color:#4985a2;--callout-tip-color:#3ea06f;--main-font:'Signika',ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--code-font:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;--homepage-max-width:750px;--main-max-width:750px;--avatar-size:70px;--paragraph-font-size:18px;--paragraph-line-height:1.75;--aside-font-size:16px;--img-border-radius:0;--inline-code-border-radius:2px}body.dark{--primary-color:#698bcf;--primary-pale-color:#698bcf1c;--text-color:#9197a5;--text-pale-color:#5d6470;--bg-color:#202124;--highlight-mark-color:#5f75b045;--callout-note-color:#698bcf;--callout-important-color:#9971d9;--callout-warning-color:#c99054;--callout-alert-color:#d35757;--callout-question-color:#4985a2;--callout-tip-color:#3ea06f}</style><link href=/main.css rel=stylesheet><link href=/hl-light.css id=hl rel=stylesheet><body class=post><script>if(localStorage.getItem('theme')=='dark'){document.body.classList.add('dark');const a=document.querySelector('link#hl');if(a)a.href='/hl-dark.css'}</script><header><div id=header-wrapper><nav><a href=/>grnmeira</a><span class=separator>/</span><a href=/posts>posts</a></nav><div id=btns><button aria-label="theme switch" data-moon-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M10 7C10 10.866 13.134 14 17 14C18.9584 14 20.729 13.1957 21.9995 11.8995C22 11.933 22 11.9665 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C12.0335 2 12.067 2 12.1005 2.00049C10.8043 3.27098 10 5.04157 10 7ZM4 12C4 16.4183 7.58172 20 12 20C15.0583 20 17.7158 18.2839 19.062 15.7621C18.3945 15.9187 17.7035 16 17 16C12.0294 16 8 11.9706 8 7C8 6.29648 8.08133 5.60547 8.2379 4.938C5.71611 6.28423 4 8.9417 4 12Z" fill="currentColor"></path></svg>' data-sun-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M12 18C8.68629 18 6 15.3137 6 12C6 8.68629 8.68629 6 12 6C15.3137 6 18 8.68629 18 12C18 15.3137 15.3137 18 12 18ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16ZM11 1H13V4H11V1ZM11 20H13V23H11V20ZM3.51472 4.92893L4.92893 3.51472L7.05025 5.63604L5.63604 7.05025L3.51472 4.92893ZM16.9497 18.364L18.364 16.9497L20.4853 19.0711L19.0711 20.4853L16.9497 18.364ZM19.0711 3.51472L20.4853 4.92893L18.364 7.05025L16.9497 5.63604L19.0711 3.51472ZM5.63604 16.9497L7.05025 18.364L4.92893 20.4853L3.51472 19.0711L5.63604 16.9497ZM23 11V13H20V11H23ZM4 11V13H1V11H4Z" fill="currentColor"></path></svg>' id=theme-toggle><svg viewbox="0 0 24 24" height=24 width=24 xmlns=http://www.w3.org/2000/svg><path d="M10 7C10 10.866 13.134 14 17 14C18.9584 14 20.729 13.1957 21.9995 11.8995C22 11.933 22 11.9665 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C12.0335 2 12.067 2 12.1005 2.00049C10.8043 3.27098 10 5.04157 10 7ZM4 12C4 16.4183 7.58172 20 12 20C15.0583 20 17.7158 18.2839 19.062 15.7621C18.3945 15.9187 17.7035 16 17 16C12.0294 16 8 11.9706 8 7C8 6.29648 8.08133 5.60547 8.2379 4.938C5.71611 6.28423 4 8.9417 4 12Z" fill=currentColor></path></svg></button></div></div></header><div id=wrapper><div id=blank></div><aside><button aria-label="back to top" id=back-to-top><svg viewbox="0 0 24 24" height=24 width=24 xmlns=http://www.w3.org/2000/svg><path d="M11.9997 10.8284L7.04996 15.7782L5.63574 14.364L11.9997 8L18.3637 14.364L16.9495 15.7782L11.9997 10.8284Z" fill=currentColor></path></svg></button></aside><main><div><div data-check-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M10.0007 15.1709L19.1931 5.97852L20.6073 7.39273L10.0007 17.9993L3.63672 11.6354L5.05093 10.2212L10.0007 15.1709Z" fill="currentColor"></path></svg>' data-copy-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6Z" fill="currentColor"></path></svg>' id=copy-cfg style=display:none></div><article data-backlink-icon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><path d="M9.41421 8L18.0208 16.6066L16.6066 18.0208L8 9.41421V17H6V6H17V8H9.41421Z" fill="currentColor"></path></svg>' class=prose><h1>Hello World App for PineTime Using PineSim</h1><div id=post-info><div id=date><span id=publish>2024-01-24</span></div></div><p>The intro of this text can be a bit too "bloggy". If you want to check out the step by step hello world app, go directly to <a href=https://grnmeira.github.io/posts/pinetime-helloworld/#start>this</a> section.<h1 id=why-buy-if-you-can-build-your-own>Why Buy If You Can Build Your Own?<a aria-label="Anchor link for: why-buy-if-you-can-build-your-own" class=zola-anchor href=#why-buy-if-you-can-build-your-own>#</a></h1><p>Recently I moved to a place quite close to tennis courts. It was such an inaccessible sport when was younger. Today, living here in Ireland, trying a couple of matches didn't seem such a distant idea. For the moment I'm trying to make that a habit, and I've been playing with some neighbours whenever I have a chance.<p>A few matches in I noticed something really bothered me: keeping the score is horrible. Maybe because I'm a father of two, and because of that I'm constantly sleep-deprived?<p>As soon as I decided that I needed a solution for my problem, I assumed a couple of alternatives would be available. And looking into them, the most tempting idea was phone apps that can be triggered through tiny bluetooth remotes. But then I realized the ideal solution would be a smartwatch. I've never really been a smartwatch guy... I just find them expensive and don't think I would use them enough for such an acquisition to make sense.<p>Well, and then I met <a rel="nofollow noreferrer" href=https://pine64.org/pinetime/>PineTime</a>. I had looked into <a rel="nofollow noreferrer" href=https://pine64.org>Pine64</a> stuff before, but had never got myself anything. So maybe it was time (no pun intended). PineTime is one of the cheapest smartwatches that could run an app to keep track of tennis score! It's just that... The app doesn't exist yet. So there we go, as a good programmer, why use something that's already there if you can <del>reinvent the wheel</del> build your own?<h1 id=what-is-pinetime>What Is PineTime<a aria-label="Anchor link for: what-is-pinetime" class=zola-anchor href=#what-is-pinetime>#</a></h1><p>PineTime is an opensource (hardware and software) smartwatch with quite a reasonable price. They offer two different options: a sealed watch, just targeted at end-users, and a development kit which can even be debugged with OpenOCD! How awesome is that?<p>The hardware is based on an ESP32 platform and contains a few sensors (like heart rate, step counter, accelerometer, etc.). The default firmware is <a rel="nofollow noreferrer" href=http://infinitime.io>InfiniTime</a>, but there's a couple of other options also available, including some <a rel="nofollow noreferrer" href=https://lupyuen.github.io/pinetime-rust-mynewt/articles/watchface>Rust-based attempts</a>.<p>And the cool thing is, even before it arrives at your door, you can easily start creating your own apps or watch faces. Some of the firmware options offer emulators. And these seem to work reasonably well, as most of these firmwares work on a very neat way using dependency inversion (you basically inject your app into the framework) and all the UI stuff is based on <a rel="nofollow noreferrer" href=https://docs.lvgl.io/6.1/index.html>LVGL</a>.<p>Getting hyped before my own PineTime arrives, I decided to write a quick hello world for InfiniTime, using <a rel="nofollow noreferrer" href=https://github.com/InfiniTimeOrg/InfiniSim>InfiniSim</a>. InfiniSim is pretty neat. It basically runs the injected app abstracting its surroundings, providing access to hardware components to the app through what it calls controllers. LVGL plays also a big role here allowing a well-defined interface for the watch's display.<p>I had a couple of hiccups along the way with the official documentation, so having a step-by-step tutorial here might be useful to other people (hopefully I'll make sometime later to update some of the official documentation on Github).<h1 id=writing-a-hello-world-in-infinisim><a name=start></a> Writing a Hello World In InfiniSim<a aria-label="Anchor link for: writing-a-hello-world-in-infinisim" class=zola-anchor href=#writing-a-hello-world-in-infinisim>#</a></h1><p>So for the starts, this was me on Ubuntu 20.04 LTS, using WSL2 (Windows 11). The cool thing about using old distros is you'll always catch version issues with older stuff (I'll use this as an excuse for not having an updated version).<h2 id=building-infinisim>Building InfiniSim<a aria-label="Anchor link for: building-infinisim" class=zola-anchor href=#building-infinisim>#</a></h2><p>First of all, we clone the InfiniSim repo available on GitHub:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> git clone<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>recursive</span> https://github.com/InfiniTimeOrg/InfiniSim.git</span>
</span></code></pre><p>Note here that we're including submodules (as some of the InfiniTime code used in the emulator comes from the actual InfiniTime repo, included as a submodule).<p>Now there's a couple of dependencies, and it might get a bit finicky with Ubuntu 20.04, but we'll get there.<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> apt-get install cmake libsdl2-dev g++-10 libpng-dev</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></code></pre><p>Note that we're installing GCC 10. InfiniSim also compiles InfiniTime code, which depends on GCC 11 according to their docs, but looks like we can get away with version 10 (the codebase requires support to <code>codeval</code>). Also, because of that, we'll have to do some juggling with compiler versions in your system:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-10 100 --slave /usr/bin/g++ g++ /usr/bin/g++-10</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></code></pre><p><strong>Note you might want to add your other GCC versions (8 is the standard installation for Ubuntu 20.04) with <code>update-alternatives</code> too.</strong><p>We have some fancy <code>match</code> statements in InfiniTime's Python scripts too, so we'll have to get Python >= 3.10 (3.8 is the default). In order to do that, we'll need to add a repo manually:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> add-apt-repository ppa:deadsnakes/ppa</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> apt-get install python3.12</span><span class="z-comment z-line z-number-sign z-shell">
</span><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> curl https://bootstrap.pypa.io/get-pip.py<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>o</span> get-pip.py</span>
<span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> python3.12 get-pip.py</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></code></pre><p>Last Python dependency is Pillow:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> pip3.12 install pillow</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></code></pre><p>If you run into trouble with multiple Python versions (like I did), we can force CMake to use Python 3.12. Unfortunately I couldn't find an easy way to do that from CMake's command line, neither using only Debian's wonderful <code>update-alternatives</code>. The way out was a workaround using both CMake and <code>update-alternatives</code>.<p>For the CMake part, we edit <code>InfiniTime/src/resources/CMakesList.txt</code> (a few Python scripts to deal with resources like fonts and images). And change the <code>find_package</code> command for Python 3 as follows (and note this is particularly true for CMake 3.12 and above only, as you can see in the comments):<pre class="language-cmake z-code" data-lang=cmake><code class=language-cmake data-lang=cmake><span class="z-source z-cmake">...
<span class="z-meta z-function-call z-cmake"><span class="z-keyword z-control z-if z-cmake">if</span></span><span class="z-meta z-group z-if z-cmake"><span class="z-meta z-function-call z-arguments z-cmake"><span class="z-punctuation z-section z-parens z-begin z-cmake">(</span><span class="z-meta z-string z-unquoted z-cmake">CMAKE_VERSION</span> <span class="z-variable z-parameter z-if z-GREATER_EQUAL z-cmake">VERSION_GREATER_EQUAL</span> <span class="z-meta z-string z-unquoted z-cmake">3.12</span><span class="z-punctuation z-section z-parens z-end z-cmake">)</span></span>
   <span class="z-comment z-line z-cmake"><span class="z-punctuation z-definition z-comment z-cmake">#</span> FindPython3 module introduces with CMake 3.12</span>
   <span class="z-comment z-line z-cmake"><span class="z-punctuation z-definition z-comment z-cmake">#</span> https://cmake.org/cmake/help/latest/module/FindPython3.html</span>
   <span class="z-meta z-function-call z-cmake"><span class="z-support z-function z-find_package z-cmake">find_package</span></span><span class="z-meta z-function-call z-arguments z-cmake"><span class="z-punctuation z-section z-parens z-begin z-cmake">(</span><span class="z-meta z-string z-unquoted z-cmake">Python3</span> <span class="z-meta z-string z-unquoted z-cmake">3.12</span> <span class="z-variable z-parameter z-REQUIRED z-cmake">REQUIRED</span><span class="z-punctuation z-section z-parens z-end z-cmake">)</span></span> <span class="z-comment z-line z-cmake"><span class="z-punctuation z-definition z-comment z-cmake">#</span> this is the line you want to change!</span>
<span class="z-meta z-function-call z-cmake"><span class="z-keyword z-control z-else z-cmake">else</span></span></span><span class="z-meta z-group z-else z-cmake"><span class="z-meta z-function-call z-arguments z-cmake"><span class="z-punctuation z-section z-parens z-begin z-cmake">(</span><span class="z-punctuation z-section z-parens z-end z-cmake">)</span></span>
   <span class="z-meta z-function-call z-cmake"><span class="z-support z-function z-set z-cmake">set</span></span><span class="z-meta z-function-call z-arguments z-cmake"><span class="z-punctuation z-section z-parens z-begin z-cmake">(</span><span class="z-variable z-other z-readwrite z-assignment z-cmake">Python3_EXECUTABLE</span> <span class="z-string z-quoted z-double z-cmake"><span class="z-punctuation z-definition z-string z-begin z-cmake">"</span>python<span class="z-punctuation z-definition z-string z-end z-cmake">"</span></span><span class="z-punctuation z-section z-parens z-end z-cmake">)</span></span>
<span class="z-meta z-function-call z-cmake"><span class="z-keyword z-control z-endif z-cmake">endif</span></span></span><span class="z-meta z-function-call z-arguments z-cmake"><span class="z-punctuation z-section z-parens z-begin z-cmake">(</span><span class="z-punctuation z-section z-parens z-end z-cmake">)</span></span>
...
</span></code></pre><p>For the <code>update-alternatives</code> part:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> sudo update-alternatives<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>install</span> /usr/bin/python3 python3 /usr/bin/python3.12 110</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> sudo update-alternatives<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>install</span> /usr/bin/python3 python3 /usr/bin/python3.8 100</span>
</span></code></pre><p>And now, the last annoying dependency, I promise, node.js 14 (default is 10).<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> curl<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>fsSL</span> https://deb.nodesource.com/setup_lts.x</span> <span class="z-keyword z-operator z-logical z-pipe z-shell">|</span> <span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">sudo</span></span><span class="z-meta z-function-call z-arguments z-shell"><span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>E</span> bash -</span>
<span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> apt-get install nodejs</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></code></pre><p>And that's because we need <code>lv_font_conv</code> (which is a bit weird actually, as it looks like we have some Python scripts that do its job now).<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> npm i lv_font_conv -g</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></code></pre><p>Now, fingers crossed.<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> cd InfiniSim</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> cmake<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>S</span> .<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>B</span> build</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> cmake<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>build</span> build</span>
</span></code></pre><p>If you're lucky enough, now you can run the emulator:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> ./build/infinisim</span>
</span></code></pre><p><img alt="InfiniSim running" src=/img/pinesim-running.png> It worked pretty well with WSL2 running directly from PowerShell. On my attempts trying to run it from MobaXTerm, it would crash in SDL2 code while creating the status window. So a quick workaround is trying to hide it. It won't crash, but unfortunately you may lose precious information about what's going on with the watch.<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> ./build/infinisim<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>hide-status</span></span>
</span></code></pre><h2 id=creating-your-app>Creating Your App<a aria-label="Anchor link for: creating-your-app" class=zola-anchor href=#creating-your-app>#</a></h2><p>As we mentioned before, there's a git submodule for InfiniTime inside InfiniSim's repository. For now, we'll just use that to make things easier for us.<p>In InfiniSim, apps are called "screens". Screens are their own classes, and you can find a bunch of them in <code>src/displayapp/screens</code>. All of those can be used as examples, which is great for understanding the system.<p>Let's start with a header file with the declarations for our screen class, let's call it <code>HelloWorld.h</code> (so <code>InfiniTime/src/displayapp/screens/HelloWorld.h</code>). It's declared inside the namespace <code>Pinetime::Applications::Screens</code>, and it extends Screen (which is declared in <code>Screen.h</code>).<pre class="language-c++ z-code" data-lang=c++><code class=language-c++ data-lang=c++><span class="z-source z-c++"><span class="z-meta z-preprocessor z-c++"><span class="z-keyword z-control z-import z-c++">#pragma</span> once
</span>
<span class="z-meta z-preprocessor z-include z-c++"><span class="z-keyword z-control z-import z-include z-c++">#include</span> <span class="z-string z-quoted z-double z-include z-c++"><span class="z-punctuation z-definition z-string z-begin z-c++">"</span>displayapp/apps/Apps.h<span class="z-punctuation z-definition z-string z-end z-c++">"</span></span>
</span><span class="z-meta z-preprocessor z-include z-c++"><span class="z-keyword z-control z-import z-include z-c++">#include</span> <span class="z-string z-quoted z-double z-include z-c++"><span class="z-punctuation z-definition z-string z-begin z-c++">"</span>displayapp/screens/Screen.h<span class="z-punctuation z-definition z-string z-end z-c++">"</span></span>
</span><span class="z-meta z-preprocessor z-include z-c++"><span class="z-keyword z-control z-import z-include z-c++">#include</span> <span class="z-string z-quoted z-double z-include z-c++"><span class="z-punctuation z-definition z-string z-begin z-c++">"</span>displayapp/Controllers.h<span class="z-punctuation z-definition z-string z-end z-c++">"</span></span>
</span><span class="z-meta z-preprocessor z-include z-c++"><span class="z-keyword z-control z-import z-include z-c++">#include</span> <span class="z-string z-quoted z-double z-include z-c++"><span class="z-punctuation z-definition z-string z-begin z-c++">"</span>Symbols.h<span class="z-punctuation z-definition z-string z-end z-c++">"</span></span>
</span>
<span class="z-meta z-namespace z-c++"><span class="z-keyword z-control z-c++">namespace</span> </span><span class="z-meta z-namespace z-c++"><span class="z-entity z-name z-namespace z-c++">Pinetime</span></span><span class="z-meta z-namespace z-c++"> <span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span>
  <span class="z-meta z-namespace z-c++"><span class="z-keyword z-control z-c++">namespace</span> </span><span class="z-meta z-namespace z-c++"><span class="z-entity z-name z-namespace z-c++">Applications</span></span><span class="z-meta z-namespace z-c++"> <span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span>
    <span class="z-meta z-namespace z-c++"><span class="z-keyword z-control z-c++">namespace</span> </span><span class="z-meta z-namespace z-c++"><span class="z-entity z-name z-namespace z-c++">Screens</span></span><span class="z-meta z-namespace z-c++"> <span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span>
      <span class="z-meta z-class z-c++"><span class="z-storage z-type z-c++">class</span> </span><span class="z-meta z-class z-c++"><span class="z-entity z-name z-class z-c++">HelloWorld</span></span><span class="z-meta z-class z-c++"> <span class="z-punctuation z-separator z-c++">:</span> <span class="z-storage z-modifier z-c++">public</span> <span class="z-entity z-other z-inherited-class z-c++">Screen</span> <span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span></span></span><span class="z-meta z-class z-c++"><span class="z-meta z-block z-c++">
      <span class="z-storage z-modifier z-c++">public</span><span class="z-punctuation z-section z-class z-c++">:</span>
        <span class="z-meta z-method z-constructor z-c++"><span class="z-entity z-name z-function z-constructor z-c++">HelloWorld</span></span><span class="z-meta z-method z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-method z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
        <span class="z-meta z-method z-destructor z-c++"><span class="z-entity z-name z-function z-destructor z-c++">~HelloWorld</span></span><span class="z-meta z-method z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-method z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-meta z-method z-c++"> <span class="z-storage z-modifier z-c++">override</span></span><span class="z-punctuation z-terminator z-c++">;</span>
      </span></span><span class="z-meta z-class z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-end z-c++">}</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
    </span><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-end z-c++">}</span></span></span>

    <span class="z-meta z-template z-c++"><span class="z-storage z-type z-template z-c++">template</span> <span class="z-punctuation z-section z-generic z-begin z-c++"><</span></span><span class="z-meta z-template z-c++"><span class="z-punctuation z-section z-generic z-end z-c++">></span></span>
    <span class="z-meta z-struct z-c++"><span class="z-storage z-type z-c++">struct</span> </span><span class="z-meta z-struct z-c++"><span class="z-entity z-name z-struct z-c++">AppTraits</span></span><span class="z-meta z-struct z-c++"><span class="z-punctuation z-section z-generic z-begin z-c++"><</span>Apps<span class="z-punctuation z-accessor z-double-colon z-c++">::</span>HelloWorld<span class="z-punctuation z-section z-generic z-end z-c++">></span> <span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span></span></span><span class="z-meta z-struct z-c++"><span class="z-meta z-block z-c++">
      <span class="z-storage z-modifier z-c++">static</span> <span class="z-storage z-modifier z-c++">constexpr</span> Apps app <span class="z-keyword z-operator z-assignment z-c">=</span> Apps<span class="z-punctuation z-accessor z-double-colon z-c++">::</span>HelloWorld<span class="z-punctuation z-terminator z-c++">;</span>
      <span class="z-storage z-modifier z-c++">static</span> <span class="z-storage z-modifier z-c++">constexpr</span> <span class="z-storage z-modifier z-c++">const</span> <span class="z-storage z-type z-c">char</span><span class="z-keyword z-operator z-c++">*</span> icon <span class="z-keyword z-operator z-assignment z-c">=</span> Screens<span class="z-punctuation z-accessor z-double-colon z-c++">::</span>Symbols<span class="z-punctuation z-accessor z-double-colon z-c++">::</span>eye<span class="z-punctuation z-terminator z-c++">;</span>
      <span class="z-storage z-modifier z-c++">static</span> Screens<span class="z-punctuation z-accessor z-double-colon z-c++">::</span>Screen<span class="z-keyword z-operator z-c++">*</span> <span class="z-meta z-method z-c++"><span class="z-entity z-name z-function z-c++">Create</span></span><span class="z-meta z-method z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-method z-parameters z-c++"><span class="z-meta z-group z-c++">AppControllers<span class="z-keyword z-operator z-c">&</span> <span class="z-variable z-parameter z-c++">controllers</span><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-meta z-method z-c++"> </span><span class="z-meta z-method z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span></span></span><span class="z-meta z-method z-c++"><span class="z-meta z-block z-c++">
        <span class="z-keyword z-control z-flow z-return z-c++">return</span> <span class="z-keyword z-control z-c++">new</span> <span class="z-meta z-function-call z-c++">Screens<span class="z-punctuation z-accessor z-double-colon z-c++">::</span><span class="z-variable z-function z-c++">HelloWorld</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
      </span></span><span class="z-meta z-method z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-end z-c++">}</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
    </span></span><span class="z-meta z-struct z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-end z-c++">}</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
  </span><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-end z-c++">}</span></span></span>
</span><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-end z-c++">}</span></span></span>
</span></code></pre><p>For a simple hello world, our class doesn't need anything fancy, we declare a constructor and a destructor. The lifecycle of a screen is quite simple, the constructor will be called when the app is launched, and once the app is closed, the destructor is called.<p>Note as well the static trait pattern below the class declaration. That's used to capture some meta-information about the app and to provide a factory member function (<code>Create</code>). <code>AppTraits&LTApps::HelloWorld>::icon</code> will define which icon will be used for the app when listed in the PineTime menus. <code>Create</code> receives an <code>AppController</code> reference, which is basically a way for the InfiniTime framework to provide access to system resources. We won't need those today.<p>We're creating now the definitions for our class. That will be <code>InfiniTime/src/displayapp/screens/HelloWorld.cpp</code>.<pre class="language-c++ z-code" data-lang=c++><code class=language-c++ data-lang=c++><span class="z-source z-c++"><span class="z-meta z-preprocessor z-include z-c++"><span class="z-keyword z-control z-import z-include z-c++">#include</span> <span class="z-string z-quoted z-double z-include z-c++"><span class="z-punctuation z-definition z-string z-begin z-c++">"</span>displayapp/screens/HelloWorld.h<span class="z-punctuation z-definition z-string z-end z-c++">"</span></span>
</span>
<span class="z-meta z-namespace z-c++"><span class="z-keyword z-control z-c++">namespace</span> </span><span class="z-meta z-namespace z-c++"><span class="z-entity z-name z-namespace z-c++">Pinetime<span class="z-punctuation z-accessor z-double-colon z-c++">::</span>Applications<span class="z-punctuation z-accessor z-double-colon z-c++">::</span>Screens</span></span><span class="z-meta z-namespace z-c++"> <span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span>
  <span class="z-meta z-function z-c++"><span class="z-meta z-toc-list z-full-identifier z-c++">HelloWorld<span class="z-punctuation z-accessor z-double-colon z-c++">::</span><span class="z-entity z-name z-function z-constructor z-c++">HelloWorld</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-meta z-function z-c++"> </span><span class="z-meta z-function z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span></span></span><span class="z-meta z-function z-c++"><span class="z-meta z-block z-c++">
    lv_obj_t<span class="z-keyword z-operator z-c">*</span> title <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">lv_label_create</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">lv_scr_act</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-separator z-c++">,</span> <span class="z-constant z-language z-c++">nullptr</span></span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
    <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">lv_label_set_text_static</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++">title<span class="z-punctuation z-separator z-c++">,</span> <span class="z-string z-quoted z-double z-c"><span class="z-punctuation z-definition z-string z-begin z-c">"</span>Hello World!<span class="z-punctuation z-definition z-string z-end z-c">"</span></span></span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
    <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">lv_label_set_align</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++">title<span class="z-punctuation z-separator z-c++">,</span> LV_LABEL_ALIGN_CENTER</span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
    <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">lv_obj_align</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++">title<span class="z-punctuation z-separator z-c++">,</span> <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">lv_scr_act</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-separator z-c++">,</span> LV_ALIGN_CENTER<span class="z-punctuation z-separator z-c++">,</span> <span class="z-constant z-numeric z-integer z-decimal z-c++">0</span><span class="z-punctuation z-separator z-c++">,</span> <span class="z-constant z-numeric z-integer z-decimal z-c++">0</span></span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
  </span></span><span class="z-meta z-function z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-end z-c++">}</span></span></span>

  <span class="z-meta z-function z-c++"><span class="z-meta z-toc-list z-full-identifier z-c++">HelloWorld<span class="z-punctuation z-accessor z-double-colon z-c++">::</span><span class="z-entity z-name z-function z-destructor z-c++">~HelloWorld</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-meta z-function z-c++"> </span><span class="z-meta z-function z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span></span></span><span class="z-meta z-function z-c++"><span class="z-meta z-block z-c++">
    <span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">lv_obj_clean</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-meta z-function-call z-c++"><span class="z-variable z-function z-c++">lv_scr_act</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span></span></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
  </span></span><span class="z-meta z-function z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-end z-c++">}</span></span></span>
</span><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-end z-c++">}</span></span></span>
</span></code></pre><p>That's even shorter than our header. In the constructor we simply create a label using LVGL and write "Hello World!" to it. We align the text to the center of the label and the label to the center of the screen.<p><code>lv_scr_act</code> returns a pointer to the active screen, <code>lv_obj_clean</code>... Well, cleans the screen up once the app is gone.<p>Now, before we make our screen run in the emulator, there's a couple of things we have to get sorted first. We need to tell InfiniTime about our app. And the way we do it is inserting the following lines.<p>In <code>src/CMakeLists.txt</code>, when setting the <code>INCLUDE_FILES</code> variables.<pre class="language-cmake z-code" data-lang=cmake><code class=language-cmake data-lang=cmake><span class="z-source z-cmake">...
<span class="z-meta z-function-call z-cmake"><span class="z-support z-function z-set z-cmake">set</span></span><span class="z-meta z-function-call z-arguments z-cmake"><span class="z-punctuation z-section z-parens z-begin z-cmake">(</span><span class="z-variable z-other z-readwrite z-assignment z-cmake">INCLUDE_FILES</span>
  <span class="z-meta z-string z-unquoted z-cmake">...</span>
  <span class="z-meta z-string z-unquoted z-cmake">displayapp/screens/HelloWorld.cpp</span>
  <span class="z-meta z-string z-unquoted z-cmake">...</span>
  <span class="z-meta z-string z-unquoted z-cmake">displayapp/screens/HelloWorld.h</span>
  <span class="z-meta z-string z-unquoted z-cmake">...</span>
<span class="z-punctuation z-section z-parens z-end z-cmake">)</span></span>
...
</span></code></pre><p>In <code>src/displayapp/UserApps.h</code>:<pre class="language-c++ z-code" data-lang=c++><code class=language-c++ data-lang=c++><span class="z-source z-c++"><span class="z-keyword z-operator z-variadic z-c">...</span>
<span class="z-meta z-preprocessor z-include z-c++"><span class="z-keyword z-control z-import z-include z-c++">#include</span> <span class="z-string z-quoted z-double z-include z-c++"><span class="z-punctuation z-definition z-string z-begin z-c++">"</span>displayapp/screens/WatchFaceInfineat.h<span class="z-punctuation z-definition z-string z-end z-c++">"</span></span>
</span><span class="z-meta z-preprocessor z-include z-c++"><span class="z-keyword z-control z-import z-include z-c++">#include</span> <span class="z-string z-quoted z-double z-include z-c++"><span class="z-punctuation z-definition z-string z-begin z-c++">"</span>displayapp/screens/WatchFacePineTimeStyle.h<span class="z-punctuation z-definition z-string z-end z-c++">"</span></span>
</span><span class="z-meta z-preprocessor z-include z-c++"><span class="z-keyword z-control z-import z-include z-c++">#include</span> <span class="z-string z-quoted z-double z-include z-c++"><span class="z-punctuation z-definition z-string z-begin z-c++">"</span>displayapp/screens/WatchFaceTerminal.h<span class="z-punctuation z-definition z-string z-end z-c++">"</span></span>
</span><span class="z-meta z-preprocessor z-include z-c++"><span class="z-keyword z-control z-import z-include z-c++">#include</span> <span class="z-string z-quoted z-double z-include z-c++"><span class="z-punctuation z-definition z-string z-begin z-c++">"</span>displayapp/screens/HelloWorld.h<span class="z-punctuation z-definition z-string z-end z-c++">"</span></span> <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> add this header!</span>
</span><span class="z-keyword z-operator z-variadic z-c">...</span>
</span></code></pre><p>In <code>src/displayapp/apps/Apps.h.in</code>:<pre class="language-c++ z-code" data-lang=c++><code class=language-c++ data-lang=c++><span class="z-source z-c++"><span class="z-meta z-namespace z-c++"><span class="z-keyword z-control z-c++">namespace</span> </span><span class="z-meta z-namespace z-c++"><span class="z-entity z-name z-namespace z-c++">Pinetime</span></span><span class="z-meta z-namespace z-c++"> <span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span>
  <span class="z-meta z-namespace z-c++"><span class="z-keyword z-control z-c++">namespace</span> </span><span class="z-meta z-namespace z-c++"><span class="z-entity z-name z-namespace z-c++">Applications</span></span><span class="z-meta z-namespace z-c++"> <span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span>
    <span class="z-meta z-enum z-c++"><span class="z-storage z-type z-c++">enum class</span> </span><span class="z-meta z-enum z-c++"><span class="z-entity z-name z-enum z-c++">Apps</span></span><span class="z-meta z-enum z-c++"> <span class="z-punctuation z-separator z-c++">:</span> <span class="z-entity z-other z-inherited-class z-c++">uint8_t</span> <span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span></span></span><span class="z-meta z-enum z-c++"><span class="z-meta z-block z-c++">
    <span class="z-keyword z-operator z-variadic z-c">...</span>
    Error<span class="z-punctuation z-separator z-c++">,</span>
    Weather<span class="z-punctuation z-separator z-c++">,</span>
    HelloWorld <span class="z-comment z-line z-double-slash z-c"><span class="z-punctuation z-definition z-comment z-c">//</span> add this enum value!
</span>  </span></span><span class="z-meta z-enum z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-end z-c++">}</span></span></span>
  <span class="z-keyword z-operator z-variadic z-c">...</span>
</span></span></span></span></span></code></pre><p>In <code>src/displayapp/apps/CMakeLists.txt</code>, add <code>Apps::HelloWorld</code> to the <code>USERAPP_TYPES</code> variable:<pre class="language-cmake z-code" data-lang=cmake><code class=language-cmake data-lang=cmake><span class="z-source z-cmake">...
<span class="z-meta z-function-call z-cmake"><span class="z-support z-function z-set z-cmake">set</span></span><span class="z-meta z-function-call z-arguments z-cmake"><span class="z-punctuation z-section z-parens z-begin z-cmake">(</span><span class="z-variable z-other z-readwrite z-assignment z-cmake">USERAPP_TYPES</span> <span class="z-string z-quoted z-double z-cmake"><span class="z-punctuation z-definition z-string z-begin z-cmake">"</span>Apps::Navigation, Apps::StopWatch, Apps::Alarm, Apps::Timer, Apps::Steps, Apps::HeartRate, Apps::Music, Apps::Paint, Apps::Paddle, Apps::Twos, Apps::Metronome, Apps::HelloWorld<span class="z-punctuation z-definition z-string z-end z-cmake">"</span></span> <span class="z-variable z-parameter z-foreach z-CACHE z-cmake">CACHE</span> <span class="z-storage z-type z-STRING z-cmake">STRING</span> <span class="z-string z-quoted z-double z-cmake"><span class="z-punctuation z-definition z-string z-begin z-cmake">"</span>List of user apps to build into the firmware<span class="z-punctuation z-definition z-string z-end z-cmake">"</span></span><span class="z-punctuation z-section z-parens z-end z-cmake">)</span></span>
...
</span></code></pre><p>And don't forget:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-comment z-line z-number-sign z-shell"><span class="z-punctuation z-definition z-comment z-begin z-shell">#</span></span><span class="z-comment z-line z-number-sign z-shell"> cd src/displayapp/apps && cmake .</span><span class="z-comment z-line z-number-sign z-shell">
</span></span></code></pre><p>This will generate an <code>Apps.h</code> header in case you're missing something.<p>And to get this finally over with, once again:<pre class="language-bash z-code" data-lang=bash><code class=language-bash data-lang=bash><span class="z-source z-shell z-bash"><span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> cmake<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>S</span> .<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> -</span>B</span> build</span>
<span class="z-meta z-function-call z-shell"><span class="z-variable z-function z-shell">$</span></span><span class="z-meta z-function-call z-arguments z-shell"> cmake<span class="z-variable z-parameter z-option z-shell"><span class="z-punctuation z-definition z-parameter z-shell"> --</span>build</span> build</span>
</span></code></pre><p>So here you are. Once that's all done, you're able to run InfiniSim including now your own hello world app. <img alt="InfiniSim running our Hello World app" src=/img/infinisim-hello-world.gif> Note that the icon used by the Hello World app is an "eye". That was specified in that traits struct we had in our <code>HelloWorld.h</code> header.<pre class="language-c++ z-code" data-lang=c++><code class=language-c++ data-lang=c++><span class="z-source z-c++"><span class="z-keyword z-operator z-variadic z-c">...</span>
<span class="z-storage z-modifier z-c++">static</span> <span class="z-storage z-modifier z-c++">constexpr</span> <span class="z-storage z-modifier z-c++">const</span> <span class="z-storage z-type z-c">char</span><span class="z-keyword z-operator z-c++">*</span> icon <span class="z-keyword z-operator z-assignment z-c">=</span> Screens<span class="z-punctuation z-accessor z-double-colon z-c++">::</span>Symbols<span class="z-punctuation z-accessor z-double-colon z-c++">::</span>eye<span class="z-punctuation z-terminator z-c++">;</span>
<span class="z-keyword z-operator z-variadic z-c">...</span>
</span></code></pre><p>That was basically our icon of choice as it was something already available. But honestly it looks pretty lame, I really think we should find something a bit better.<h2 id=changing-the-icon>Changing the Icon<a aria-label="Anchor link for: changing-the-icon" class=zola-anchor href=#changing-the-icon>#</a></h2><p>For screens, InfiniTime already provides a collection of icons from the free <a rel="nofollow noreferrer" href=https://fontawesome.com>Font Awesome</a> collection. In order to use one of those icons, you can start browsing what's available <a href="https://fontawesome.com/search?o=r&m=free" rel="nofollow noreferrer">here</a> (no guarantees what's currently in InfiniTime is the most updated version of the icon library, though).<p>For this how-to let's pick the stroopwafel icon, just because I'm a big fan of this Dutch specialty. Going into the icon details you will find the Unicode code point, in this particular case it's <code>f551</code>.<p>We'll now edit <code>src/displayapp/fonts/fonts.json</code>. This file is read by the <code>generate.py</code> script in the same directory and it's used to select just the icons in use by InfiniTime from TTF/WOFF files and turn them into static content used by LVGL later.<p>We'll add our code point to be extract from the Font Awesome file. We do that by adding it to one of the "range" entries. Note that even though we're extracting the icon from a Font Awesome WOFF, it's being added to the <code>jetbrains_mono_bold_20</code> bundle. If you're curious, the final result will be available in <code>InfiniSim/build/fonts/jetbrains_mono_bold_20.c</code>.<pre class="language-json z-code" data-lang=json><code class=language-json data-lang=json><span class="z-source z-json">  ...
   <span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>jetbrains_mono_bold_20<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>: <span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
      </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>sources<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-sequence z-json"><span class="z-punctuation z-section z-sequence z-begin z-json">[</span>
         <span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
            </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>file<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>JetBrainsMono-Bold.ttf<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
            </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>range<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>0x20-0x7e, 0x410-0x44f, 0xB0<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>
         <span class="z-punctuation z-section z-mapping z-end z-json">}</span></span><span class="z-punctuation z-separator z-sequence z-json">,</span>
         <span class="z-meta z-mapping z-json"><span class="z-punctuation z-section z-mapping z-begin z-json">{</span>
            </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>file<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>FontAwesome5-Solid+Brands+Regular.woff<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
            </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>range<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>0xf294, 0xf242, 0xf54b, 0xf21e, 0xf1e6, 0xf017, 0xf129, 0xf03a, 0xf185, 0xf560, 0xf001, 0xf3fd, 0xf1fc, 0xf45d, 0xf59f, 0xf5a0, 0xf027, 0xf028, 0xf6a9, 0xf04b, 0xf04c, 0xf048, 0xf051, 0xf095, 0xf3dd, 0xf04d, 0xf2f2, 0xf024, 0xf252, 0xf569, 0xf06e, 0xf015, 0xf00c, 0xf551<span class="z-punctuation z-definition z-string z-end z-json">"</span></span>
         <span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>
      <span class="z-punctuation z-section z-sequence z-end z-json">]</span></span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
      </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>bpp<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-constant z-numeric z-integer z-decimal z-json">1</span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
      </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>size<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-constant z-numeric z-integer z-decimal z-json">20</span><span class="z-punctuation z-separator z-mapping z-pair z-json">,</span>
      </span><span class="z-meta z-mapping z-key z-json"><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>patches<span class="z-punctuation z-definition z-string z-end z-json">"</span></span></span><span class="z-meta z-mapping z-value z-json"><span class="z-punctuation z-separator z-mapping z-key-value z-json">:</span> </span><span class="z-meta z-mapping z-value z-json"><span class="z-meta z-sequence z-json"><span class="z-punctuation z-section z-sequence z-begin z-json">[</span><span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>jetbrains_mono_bold_20.c_zero.patch<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-separator z-sequence z-json">,</span> <span class="z-string z-quoted z-double z-json"><span class="z-punctuation z-definition z-string z-begin z-json">"</span>jetbrains_mono_bold_20.c_M.patch<span class="z-punctuation z-definition z-string z-end z-json">"</span></span><span class="z-punctuation z-section z-sequence z-end z-json">]</span></span>
   <span class="z-punctuation z-section z-mapping z-end z-json">}</span></span>,
  ...
</span></code></pre><p>Now we need to convert the code point into UTF-8. Let's use python for that.<pre class="language-python z-code" data-lang=python><code class=language-python data-lang=python><span class="z-source z-python"><span class="z-keyword z-operator z-comparison z-python">></span><span class="z-keyword z-operator z-comparison z-python">></span><span class="z-keyword z-operator z-comparison z-python">></span> <span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-support z-function z-builtin z-python">chr</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-constant z-numeric z-integer z-hexadecimal z-python"><span class="z-punctuation z-definition z-numeric z-base z-python">0x</span>f551</span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span><span class="z-meta z-function-call z-python"><span class="z-meta z-qualified-name z-python"><span class="z-punctuation z-accessor z-dot z-python">.</span></span><span class="z-meta z-qualified-name z-python"><span class="z-variable z-function z-python"><span class="z-meta z-generic-name z-python">encode</span></span></span></span><span class="z-meta z-function-call z-arguments z-python"><span class="z-punctuation z-section z-arguments z-begin z-python">(</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python">utf-8<span class="z-punctuation z-definition z-string z-end z-python">'</span></span></span><span class="z-punctuation z-section z-arguments z-end z-python">)</span></span>
<span class="z-storage z-type z-string z-python">b</span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-punctuation z-definition z-string z-begin z-python">'</span></span></span><span class="z-meta z-string z-python"><span class="z-string z-quoted z-single z-python"><span class="z-constant z-character z-escape z-hex z-python">\xef</span><span class="z-constant z-character z-escape z-hex z-python">\x95</span><span class="z-constant z-character z-escape z-hex z-python">\x91</span><span class="z-punctuation z-definition z-string z-end z-python">'</span></span></span>
</span></code></pre><p>Let's add the result to <code>InfiniTime/src/displayapp/screens/Symbols.h</code>.<pre class="language-c++ z-code" data-lang=c++><code class=language-c++ data-lang=c++><span class="z-source z-c++">    <span class="z-keyword z-operator z-variadic z-c">...</span>
    <span class="z-storage z-modifier z-c++">static</span> <span class="z-storage z-modifier z-c++">constexpr</span> <span class="z-storage z-modifier z-c++">const</span> <span class="z-storage z-type z-c">char</span><span class="z-keyword z-operator z-c++">*</span> stroopwafel <span class="z-keyword z-operator z-assignment z-c">=</span> <span class="z-string z-quoted z-double z-c"><span class="z-punctuation z-definition z-string z-begin z-c">"</span><span class="z-constant z-character z-escape z-c">\xEF</span><span class="z-constant z-character z-escape z-c">\x95</span><span class="z-constant z-character z-escape z-c">\x91</span><span class="z-punctuation z-definition z-string z-end z-c">"</span></span><span class="z-punctuation z-terminator z-c++">;</span>
    <span class="z-keyword z-operator z-variadic z-c">...</span>
</span></code></pre><p>And the most important, don't forget to update your app's traits in <code>HelloWorld.h</code>!<pre class="language-c++ z-code" data-lang=c++><code class=language-c++ data-lang=c++><span class="z-source z-c++">    <span class="z-keyword z-operator z-variadic z-c">...</span>
    <span class="z-meta z-template z-c++"><span class="z-storage z-type z-template z-c++">template</span> <span class="z-punctuation z-section z-generic z-begin z-c++"><</span></span><span class="z-meta z-template z-c++"><span class="z-punctuation z-section z-generic z-end z-c++">></span></span>
    <span class="z-meta z-struct z-c++"><span class="z-storage z-type z-c++">struct</span> </span><span class="z-meta z-struct z-c++"><span class="z-entity z-name z-struct z-c++">AppTraits</span></span><span class="z-meta z-struct z-c++"><span class="z-punctuation z-section z-generic z-begin z-c++"><</span>Apps<span class="z-punctuation z-accessor z-double-colon z-c++">::</span>HelloWorld<span class="z-punctuation z-section z-generic z-end z-c++">></span> <span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span></span></span><span class="z-meta z-struct z-c++"><span class="z-meta z-block z-c++">
      <span class="z-storage z-modifier z-c++">static</span> <span class="z-storage z-modifier z-c++">constexpr</span> Apps app <span class="z-keyword z-operator z-assignment z-c">=</span> Apps<span class="z-punctuation z-accessor z-double-colon z-c++">::</span>HelloWorld<span class="z-punctuation z-terminator z-c++">;</span>
      <span class="z-storage z-modifier z-c++">static</span> <span class="z-storage z-modifier z-c++">constexpr</span> <span class="z-storage z-modifier z-c++">const</span> <span class="z-storage z-type z-c">char</span><span class="z-keyword z-operator z-c++">*</span> icon <span class="z-keyword z-operator z-assignment z-c">=</span> Screens<span class="z-punctuation z-accessor z-double-colon z-c++">::</span>Symbols<span class="z-punctuation z-accessor z-double-colon z-c++">::</span>stroopwafel<span class="z-punctuation z-terminator z-c++">;</span>
      <span class="z-storage z-modifier z-c++">static</span> Screens<span class="z-punctuation z-accessor z-double-colon z-c++">::</span>Screen<span class="z-keyword z-operator z-c++">*</span> <span class="z-meta z-method z-c++"><span class="z-entity z-name z-function z-c++">Create</span></span><span class="z-meta z-method z-parameters z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-method z-parameters z-c++"><span class="z-meta z-group z-c++">AppControllers<span class="z-keyword z-operator z-c">&</span> <span class="z-variable z-parameter z-c++">controllers</span><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-meta z-method z-c++"> </span><span class="z-meta z-method z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-begin z-c++">{</span></span></span><span class="z-meta z-method z-c++"><span class="z-meta z-block z-c++">
        <span class="z-keyword z-control z-flow z-return z-c++">return</span> <span class="z-keyword z-control z-c++">new</span> <span class="z-meta z-function-call z-c++">Screens<span class="z-punctuation z-accessor z-double-colon z-c++">::</span><span class="z-variable z-function z-c++">HelloWorld</span><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-begin z-c++">(</span></span></span><span class="z-meta z-function-call z-c++"></span><span class="z-meta z-function-call z-c++"><span class="z-meta z-group z-c++"><span class="z-punctuation z-section z-group z-end z-c++">)</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
      </span></span><span class="z-meta z-method z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-end z-c++">}</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
    </span></span><span class="z-meta z-struct z-c++"><span class="z-meta z-block z-c++"><span class="z-punctuation z-section z-block z-end z-c++">}</span></span></span><span class="z-punctuation z-terminator z-c++">;</span>
    <span class="z-keyword z-operator z-variadic z-c">...</span>
</span></code></pre><p>That should do the job. Now you can compile and run InfiniSim once again.<pre class=z-code><code><span class="z-text z-plain">cmake --build build
./build/infinisim
</span></code></pre><p><img alt="Our app now shows with a stroopwafel icon!" src=/img/stroopwafel-icon.png> And that's it, now you have a Hello World app running on an open source smartwatch (well, actually it's an emulator of a smartwatch)! And as a bonus, the app uses a stroopwafel icon, which for me is the best part :)</article><div class=giscus></div></div><footer><div class=copyright><p>© 2023 Gustavo R. N. Meira</div><div class=credits>powered by <a rel="noreferrer noopener" href=https://www.getzola.org target=_blank>zola</a> and <a rel="noreferrer noopener" href=https://github.com/isunjn/serene target=_blank>serene</a></div></footer></main></div><script src=/js/lightense.min.js></script><script src=/js/main.js></script>